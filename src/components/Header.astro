---
import Navigation from './Navigation.astro';

interface Props {
  title?: string;
}

const { title } = Astro.props;
---

<header id="site-header" class="site-header">
  <div class="header-light-overlay"></div>
  <div class="header-content">
    <Navigation />
  </div>
</header>

<script>
  // Enhanced scroll effect for header background with Astro compatibility
  (function() {
    'use strict';
    
    function initHeaderScroll() {
      const header = document.getElementById('site-header');
      const headerOverlay = document.querySelector('.header-light-overlay');
      
      if (!header || !headerOverlay) {
        // Retry if elements aren't ready yet
        setTimeout(initHeaderScroll, 100);
        return;
      }
      
      let lastScrollY = window.scrollY;
      let ticking = false;
      
      function updateHeaderStyles() {
        const scrollY = window.scrollY;
        
        // Fade out the light overlay as user scrolls
        // Start fading at 0px, completely gone by 300px for smoother transition
        const opacity = Math.max(1 - scrollY / 300, 0);
        headerOverlay.style.opacity = opacity.toString();
        
        // Add shadow and transform effect after scrolling
        if (scrollY > 30) {
          header.classList.add('scrolled');
          // Slight translate up for scroll-away effect
          const translateY = Math.min(scrollY * 0.3, 80);
          headerOverlay.style.transform = `translateY(-${translateY}px)`;
        } else {
          header.classList.remove('scrolled');
          headerOverlay.style.transform = 'translateY(0)';
        }
        
        lastScrollY = scrollY;
        ticking = false;
      }
      
      function onScroll() {
        if (!ticking) {
          window.requestAnimationFrame(updateHeaderStyles);
          ticking = true;
        }
      }
      
      // Initial state
      updateHeaderStyles();
      
      // Listen for scroll events
      window.addEventListener('scroll', onScroll, { passive: true });
      
      // Handle resize to recalculate
      window.addEventListener('resize', updateHeaderStyles, { passive: true });
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initHeaderScroll);
    } else {
      initHeaderScroll();
    }
  })();
</script>

<style>
  .site-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1000;
    transition: box-shadow 0.3s ease;
  }
  
  .header-light-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.95);
    background-image: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(250, 250, 250, 0.95) 100%);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    z-index: -1;
    opacity: 1;
    transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1), 
                transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: opacity, transform;
    pointer-events: none;
  }
  
  .header-content {
    position: relative;
    z-index: 1;
  }
  
  /* Subtle shadow when scrolled */
  .site-header.scrolled {
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  }
  
  /* Ensure navigation links are visible */
  .site-header :global(.navigation__list a) {
    color: var(--color-ink, #1a1a1a);
  }
  
  .site-header :global(.navigation__logo) {
    color: var(--color-ink, #1a1a1a);
  }
</style>

