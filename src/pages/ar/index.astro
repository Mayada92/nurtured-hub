---
import BaseLayout from '../../layouts/BaseLayout.astro';
import FloatingLayer from '../../components/FloatingLayer';
import SectionReveal from '../../components/SectionReveal';
import ProjectCard from '../../components/ProjectCard.astro';
import PostCard from '../../components/PostCard.astro';
import StatsSection from '../../components/StatsSection';
import { getCollection } from 'astro:content';
import { getBasePath, getImagePath } from '../../utils/path';

const base = getBasePath();

const featuredProjects = (await getCollection('projects'))
  .filter((p) => p.data.lang === 'ar' && p.data.featured)
  .slice(0, 6)
  .sort((a, b) => b.data.year - a.data.year);

const recentPosts = (await getCollection('posts'))
  .filter((p) => p.data.lang === 'ar')
  .slice(0, 3)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

// Calculate actual stats from content
const allProjects = await getCollection('projects');
const allPapers = await getCollection('papers');
const allWork = await getCollection('work');

// Calculate years of experience (from 2017 when started at Saudi Aramco to now)
const workStartYear = 2017; // Started at Saudi Aramco in October 2017
const currentYear = new Date().getFullYear();
const yearsExperience = currentYear - workStartYear;

// Count projects (all languages, but display Arabic count if available, otherwise English)
const projectCountAr = allProjects.filter((p) => p.data.lang === 'ar').length;
const projectCount = projectCountAr > 0 ? projectCountAr : allProjects.filter((p) => p.data.lang === 'en').length;

// Count publications/papers (all languages, but display Arabic count if available, otherwise English)
const paperCountAr = allPapers.filter((p) => p.data.lang === 'ar').length;
const paperCount = paperCountAr > 0 ? paperCountAr : allPapers.filter((p) => p.data.lang === 'en').length;

// Domains are fixed: sports, educational-psychology, engineering, data-science
const domainCount = 4;

const stats = [
  { number: yearsExperience.toString(), label: 'سنوات خبرة' },
  { number: projectCount.toString(), label: 'مشاريع' },
  { number: paperCount.toString(), label: 'منشورات' },
  { number: domainCount.toString(), label: 'مجالات' },
];
---

<BaseLayout
  title="الرئيسية"
  description="مرحباً بك في محور الرعاية - محفظة ثنائية اللغة تعرض المشاريع والكتابات والملفات الشخصية المهنية"
  lang="ar"
>
  <div style="position: relative; min-height: 100vh;">
    <FloatingLayer client:load />
    <section class="hero">
      <div class="container">
        <SectionReveal client:load>
          <div class="hero__logo">
            <img src={getImagePath('/images/brand/nurtured-mind-logo.jpg')} alt="محور الرعاية" width="180" height="180" />
          </div>
          <h1>مرحباً بك في محور الرعاية</h1>
          <p class="hero__subtitle">
            استكشاف الأطفال والتعليم، علم البيانات، التطوع، والهندسة
          </p>
          <div class="hero__cta">
            <a href={`${base}ar/profile`} class="cta-button cta-button--profile">الملفات الشخصية</a>
            <a href={`${base}ar/projects`} class="cta-button cta-button--projects">المشاريع</a>
            <a href={`${base}ar/writing`} class="cta-button cta-button--articles">استكشف المقالات</a>
          </div>
        </SectionReveal>
      </div>
    </section>

    <section class="section section--stats">
      <div class="container">
        <StatsSection client:load stats={stats} />
      </div>
    </section>

    <section class="section">
      <div class="container">
        <SectionReveal client:load delay={0.1}>
          <h2>مشاريع مميزة</h2>
          <div class="grid grid--projects">
            {featuredProjects.map((project, i) => (
              <SectionReveal client:load delay={0.1 + i * 0.1}>
                <ProjectCard project={project} />
              </SectionReveal>
            ))}
          </div>
        </SectionReveal>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <SectionReveal client:load delay={0.2}>
          <h2>كتابات حديثة</h2>
          <div class="grid grid--posts">
            {recentPosts.map((post, i) => (
              <SectionReveal client:load delay={0.2 + i * 0.1}>
                <PostCard post={post} />
              </SectionReveal>
            ))}
          </div>
        </SectionReveal>
      </div>
    </section>

    <section class="section section--banner">
      <div class="container">
        <SectionReveal client:load delay={0.3}>
          <div class="banner">
            <div class="banner__logo">
              <img src={`${base}images/brand/nurtured-mind-logo.jpg`.replace(/\/+/g, '/')} alt="محور الرعاية" width="120" height="120" />
            </div>
            <h2>محور الرعاية</h2>
            <p>
              منصة لاستكشاف تقاطع التعليم والبيانات والتأثير الاجتماعي. ربط وجهات النظر من خلال البحث والكتابة والتطبيقات العملية.
            </p>
          </div>
        </SectionReveal>
      </div>
    </section>
  </div>
</BaseLayout>

<style>
  .hero {
    position: relative;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding-block: var(--space-8);
    overflow: hidden;
  }

  .hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--gradient-hero);
    z-index: 0;
    pointer-events: none;
  }

  .hero > * {
    position: relative;
    z-index: 1;
  }

  .hero__logo {
    margin-block-end: var(--space-6);
    display: flex;
    justify-content: center;
  }

  .hero__logo img {
    width: 180px;
    height: 180px;
    object-fit: contain;
    filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.1));
  }

  .hero h1 {
    font-size: var(--font-size-hero);
    font-weight: 700;
    line-height: 1.1;
    margin-block-end: var(--space-6);
    letter-spacing: -0.03em;
  }

  .hero__subtitle {
    font-size: 0.9625rem;
    color: var(--color-muted-ink);
    margin-block-end: var(--space-8);
    max-width: var(--hero-content-width);
    margin-inline: auto;
    line-height: 1.6;
    font-weight: 400;
  }

  .hero__cta {
    display: flex;
    gap: var(--space-3);
    justify-content: center;
    flex-wrap: wrap;
  }

  .cta-button {
    display: inline-flex;
    align-items: center;
    padding: var(--space-4) var(--space-8);
    background: white;
    border: 2px solid transparent;
    border-radius: var(--radius-xl);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.74375rem;
    letter-spacing: -0.01em;
    transition: all var(--motion-duration-normal) var(--motion-easing-smooth);
    box-shadow: var(--shadow-soft);
    position: relative;
    overflow: hidden;
  }

  .cta-button::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--gradient-button);
    opacity: 0;
    transition: opacity var(--motion-duration-normal) var(--motion-easing-smooth);
    z-index: -1;
  }

  .cta-button:hover {
    transform: translateY(-4px) scale(1.03);
    color: white;
    box-shadow: var(--shadow-button-hover);
    border-color: transparent;
  }

  .cta-button:hover::before {
    opacity: 1;
  }

  .cta-button--primary {
    background: var(--gradient-button);
    color: white;
    border-color: transparent;
    box-shadow: var(--shadow-button);
  }

  .cta-button--primary::before {
    background: var(--gradient-button-hover);
  }

  .cta-button--primary:hover {
    transform: translateY(-4px) scale(1.03);
    box-shadow: var(--shadow-button-hover);
  }

  .section {
    padding-block: var(--section-spacing);
  }

  .section--stats {
    background: var(--gradient-section);
    padding-block: var(--space-12);
    border-radius: var(--radius-xl);
    margin-block: var(--section-spacing);
    position: relative;
    overflow: hidden;
  }

  .section--stats::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
    pointer-events: none;
  }

  .section--banner {
    background: var(--gradient-section);
    padding-block: var(--space-6);
    border-radius: var(--radius-xl);
    margin-block: var(--section-spacing);
    position: relative;
    overflow: hidden;
  }

  .section--banner::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 30% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
    pointer-events: none;
  }

  .banner {
    text-align: center;
    color: var(--color-ink);
    max-width: 700px;
    margin-inline: auto;
  }

  .banner__logo {
    margin-block-end: var(--space-3);
  }

  .banner__logo img {
    width: 80px;
    height: 80px;
    object-fit: contain;
    border-radius: var(--radius-lg);
    opacity: 0.8;
  }

  .grid {
    display: grid;
    gap: var(--space-6);
  }

  .grid--projects {
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: var(--space-8);
  }

  .grid--posts {
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: var(--space-8);
  }

  @media (max-width: 768px) {
    .hero {
      min-height: 85vh;
      padding-block: var(--space-6);
    }

    .hero h1 {
      font-size: clamp(1.4rem, 5.6vw, 2.1rem);
    }

    .hero__subtitle {
      font-size: 0.7875rem;
    }

    .section {
      padding-block: var(--section-spacing-mobile);
    }

    .grid--projects,
    .grid--posts {
      grid-template-columns: 1fr;
      gap: var(--space-6);
    }
  }
</style>



